# C++手写一个线程池

## 首先抽象任务：

```cpp
class Task
{
public:
    virtual void doIt()
    {
        std::cout << "handle a task ..." << std::endl;
    }
    virtual ~Task()
    {
        std::cout << "task 的析构函数" << std::endl;
    }
};
```

-   里面一个 do 函数用来执行任务
-   一个析构函数（主要为了显示）



## 然后定义线程池:

```cpp
class ThreadPool final
{
public:
    ThreadPool();
    virtual ~ThreadPool();
    ThreadPool(const ThreadPool& rhs) = delete;
    ThreadPool& operator=(const ThreadPool&rhs) = delete;

    void init(int threadNum = 5);
    void stop();

    void addTask(Task* task);
    void removeAllTasks();


private:
    void threadFunc();

private:
    std::list<std::shared_ptr<Task>>            m_taskList;
    std::mutex                                  m_mutex;
    std::condition_variable                     m_cv;
    bool                                        m_isRunning;
    std::vector<std::shared_ptr<std::thread>>   m_threads;
};
```

**成员函数：**

-   构造函数和析构函数，构造函数什么都不干，交给`init()`函数来干，`init()`的参数是传入线程的数量
-   `init()`函数用来创建线程，并将 isRunnig 标记置为 true
-   析构函数调用`removeAllTasks()`
-   `stop()`函数用来优雅终止所有线程，手动停止
-   `addTask()`用来将任务添加到 taskList 中，相当于生产者
-   `threadFunc()`就是线程函数，作为消费者
-   `removeAllTasks()`用移除出所有的任务

**成员变量**

-   `m_taskList`消息（任务）队列
-   互斥量和条件变量
-   `isRunning` 标记用来判断线程池是否在运行
-   用 vector 来存储线程

