# 网络编程 socket 函数

>   复习一下，查漏补缺。

| 函数名称      | 函数简单描述                             |
| ------------- | ---------------------------------------- |
| socket        | 创造某种类型的套接字                     |
| bind          | 将 socket 绑定到一个 ip 与端口的二元组上 |
| listen        | 将一个 socket 变为监听状态               |
| connect       | 试图建立一个TCP 连接                     |
| accept        | 试图接受一个连接                         |
| send          | 通过一个 socket 发送数据                 |
| recv          | 通过一个 socket 收取数据                 |
| select        | 判断一组 socket 上的读写和异常事件       |
| gethostbyname | 通过域名获取机器地址                     |
| close         | 关闭一个套接字，回收该 socket 对应的资源 |
| shutdown      | 关闭 socket 收或发通道                   |
| setsockopt    | 设置套接字选项                           |
| getsockopt    | 获取一个套接字选项                       |

## bind()函数

```cpp
int bind(int socket, const struct sockaddr *address, socklen_t address_len);
```

`sockaddr_in`由端口和 IP 地址和协议组成。

如果应用程序不关心bind绑定的ip地址，可以使用INADDR_ANY(如果是IPv6，则对应in6addr_any)，这样底层的（协议栈）服务会自动选择一个合适的ip地址，这样使在一个有多个网卡机器上选择ip地址问题变得简单。如果应用程序不关心bind绑定的ip地址，可以使用INADDR_ANY(如果是IPv6，则对应in6addr_any)，这样底层的（协议栈）服务会自动选择一个合适的ip地址，这样使在一个有多个网卡机器上选择ip地址问题变得简单。如果端口为 0，代表随机选一个。注意不能重复绑定非 0 端口。客户端有时候也需要绑定。

端口是`0~65535`，客户端的端口是随机分配的，当然可以自己指定。

## select()函数

`select()`函数用来检测一组 socket 中是否有「事件」就绪，「事件」分为三类：

-   **读事件就绪：**
    -   接收缓冲区中的字节数大于等于「低水位标记」，此时`recv`返回值大于0
    -   TCP 连接的对方对端关闭连接，此时`recv`返回值为 0
    -   socket 上有新的连接请求
    -   socket 上有未处理的错误
-   **写事件就绪：**
    -   发送缓冲区的空闲位置大小 大于 低水位标记
    -   socket 的写操作被关闭了（自己调用了`shutdowm`或`close`）
    -   socket 使用非阻塞 connect
-   **异常事件就绪**
    -   socket 上收到 带外数据

