# 用户态线程和内核态线程有什么区别

这是一个组合型的问题，由很多小问题组装而成，比如：

-   用户态和内核态是什么？
-   用户级线程和内核级线程是什么对应关系？
-   内核相应系统调用是一个什么样的过程？



## 用户态和内核态

多数进程应该运行在最小权限下，因此，很多操作系统，将内存分为了内核空间和用户空间两个区域：

-   内核空间（Kernal Space），这个空间只有内核程序可以访问；
-   用户空间（User Space），这部分内存专门给应用程序使用。



用户空间中的代码被限制了只能使用一个局部的内存空间，我们说这些程序在**用户态（User Mode）** 执行。内核空间中的代码可以访问所有内存，我们称这些程序在**内核态（Kernal Mode）** 执行。



<img src="https://learn.lianglianglee.com/专栏/重学操作系统-完/assets/CgqCHl-Sm3mAG_x-AAC5MxhOcCc621.png" style="zoom:50%;" />

上图：内核程序执行在内核态（Kernal Mode），用户程序执行在用户态（User Mode）。当发生系统调用的时候，用户态的程序发起系统调用，用户态程序权限不足， 会中断执行，也就是Trap（Trap是一种中断）。

发生中断后，当前 CPU 执行的程序会中断，跳转到中断处理程序。内核程序开始执行，也就是开始处理系统调用。内核处理完成后，主动触发 Trap，这样会再次发生中断，切换回用户态工作。



## 线程模型

### 进程和线程

一个应用程序启动后会在内存中创建一个执行副本，这就是**进程**。Linux内核是一个宏内核，可以看作一个进程，开机的时候，磁盘的内核镜像倒入内存作为一个执行副本，成为内核进程。

进程可以分为用户态进程和内核态进程两类，用户态进程通常是应用程序的副本，内核态进程就是内核本身的进程。如果用户态进程需要申请资源，比如内存，可以通过系统调用想内核申请。

一个进程可以拥有多个线程。进程创建的时候，一般会有一个主线程随着进程创建而创建。

>   进程可以通过 API 创建用户态的线程，也可以通过系统调用创建内核态的线程，接下来我们说说用户态的线程和内核态的线程。