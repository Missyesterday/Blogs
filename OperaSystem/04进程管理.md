# 4 进程管理

## 4.1 进程、线程基础

### 4.1.1 进程



<img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost/操作系统/进程和线程/8-进程五个状态.jpg" style="zoom:50%;" />

在操作系统中，通常会把阻塞状态的进程的物理内存交换到硬盘，等到需要再换入到物理内存。

### 4.1.2 线程



**线程是进程中的一条执行流程**。

同一个进程中多个线程之间可以共享「代码段」、「数据段」、「打开的文件」，每个线程有自己独立的「寄存器」和「栈」。

<img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/16-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.jpg" alt="多线程" style="zoom:50%;" />

**线程的优点：**

-   一个进程中可以同时存在多个线程；
-   线程之间可以并发执行
-   线程之间可以分享地址空间和文件等资源
-   线程创建比进程快，终止也比进程快，因为需要释放的资源更少。
-   线程的切换很快，而进程的切换需要换页表
-   线程之间数据传递更快

**线程的缺点：**

-   进程中的一个线程崩溃时，会导致其所属进程的所有进程崩溃（C/C++是如此，Java 中线程崩溃并不会导致进程崩溃）



>    进程是资源（内存、打开的文件）分配的单位，线程是 CPU调度的单位；进程有一个完整的资源平台，而线程只独享必不可少的资源，线程也有「就绪、阻塞、运行」的状态。



**线程的上下文切换**

所谓操作系统的任务调度，实际上调度的对象是线程，而进程只是提供「虚拟内存」等资源。切换时，如果两个线程属于一个进程，则只需要切换私有数据；如果两个线程不属于同一个进程，则需要切换整个虚拟内存。



### 4.1.3 线程的实现

线程有三种实现方式：

-   用户线程（User Thread）：在用户空间实现线程，不由内核管理，由用户态的「线程库」管理。
-   内核线程（Kernel Thread）：在内核中实现的线程，由内核管理。
-   轻量级线程（LIghtWeight Thread）：在内核中来支持用户线程。（前几天腾讯刚问的我，没回答上。😭）

同时还需要考虑一个问题：用户线程和内核线程的对应关系。

