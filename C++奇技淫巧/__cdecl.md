# 关于`__cdecl`

`__cdecl`是「C declaration」的缩写，是C++函数调用约定之一，用来规定「函数的参数传递方式」和「堆栈的清理方式」。

`__cdecl`约定：

-   将参数从右往左一次压入堆栈
-   调用结束后，由「调用者」负责清理堆栈上的参数

也被称为「调用方清理堆栈」（caller-clean）约定，坏处有如果调用100次这个函数，那么内存中就有100份这个清理代码。



在使用`__cdecl`调用约定的函数中，函数的参数类型和顺序必须与「函数声明」中的参数类型和顺序一致，否则会导致错误。

缺点是，不同的编译器产生栈的方式不同。

`__cdecl`调用约定是C++默认的函数调用约定，也是一些标准库函数的默认调用约定，例如`printf()`和`scanf()`函数。但是对于一些需要和其他编程语言进行交互的场景，需要使用其他的调用约定，例如`__stdcall`或`__fastcall`。

在汇编语言中，最后直接`ret`。

## `__stdcall`

这是Windows API中的一种调用约定，是StandardCall的缩写，是C++的标准调用方式（不是默认），用于

-   参数从右到左入栈
-   被调用者清栈
-   缺点是无法支持可变数量的参数（因为如果参数可变，被调用者是不知道传入多少参数进来的）

在汇编语言中，返回用`ret X`，`X`代表参数占用的字节数。



告诉编译器call的方式，可以让编译器根据给定的call方式自动生成恢复堆栈的代码。



除此之外，还有fastcall，thiscall等。



Windows上C/C++默认`__stdcall`方式。

C默认只有`__cdecl`，C++默认也是这个。