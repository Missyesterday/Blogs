# MySQL 日志

更新语句的流程会涉及到 undo log（回滚日志）、redo log（重做日志）、binlog（归档日志）：

-   **undo log（回滚日志）**：是 InnoDB 存储引擎生成的日志，实现了事务中的**原子性**，主要**用于事务回滚和 MVCC。**
-   **redo log（重做日志）：**是 InnoDB 存储引擎生成的日志，实现了事务中的**持久性**，主要**用于掉电等故障恢复。**
-   **binlog （归档日志）**：是 Server 层生成的日志，主要**用于数据备份和主从复制。**



## 1. undo log

undo log 是一种用于撤销回退的日志。在事务没有提交之前，MySQL 回先记录更新前的数据到 undo log 日志文件中，当事务回滚时，可以利用 undo log 来进行回滚：

<img src="https://raw.githubusercontent.com/Missyesterday/picgo/main/picgo/image-20230830200958828.png" alt="image-20230830200958828" style="zoom:50%;" />

每当 InnoDB 引擎对一条记录进行操作（修改、删除、新增）时，要把回滚时需要的信息都记录到undo log 中：

-   在**插入**一条记录时，要把这条记录的主键值记录下来，这样回滚之后只需要把这个主键值对应的记录**删除**就好了。
-   在**删除**一条记录时，需要把这条记录中的内容都记录下来，这样之后回滚时再把由这些内容组成的记录**插入**到表中就好了
-   在**更新**一条记录时，要把被更新的列的旧值记录下来，这样之后回滚是再把这些列**更新为旧值**就好了。

在需要回滚时，就读取 undo log 里的数据，然后和原操作取反就好了；不同的操作记录的产生的 undo log 的格式也是不同的。

一条记录的



